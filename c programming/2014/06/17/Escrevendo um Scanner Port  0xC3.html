<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Escrevendo um Scanner Port em C 0xC3</title>
	
	<meta name="author" content="mh4x0f">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/mh4x0f">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/mh4x0f">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:mh4root@gmail.com">
				<i class="fa fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="http://avatars.githubusercontent.com/u/6795613" class="img-circle" />
				
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/categories.html">Categories</a></li>
				<li><a href="/tags.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="http://avatars.githubusercontent.com/u/6795613" class="img-circle" style="width:112px;height:112px;" />
	</a>
	<h3 class="title">
        <a href="/"></a>
    </h3>
</header>


<div id="bio" class="text-center">
	One 0x41414141 worth a thousand words
</div>

<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/mh4x0f">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/mh4x0f">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:mh4root@gmail.com">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		
		<form class="col-lg-12" action="http://feedburner.google.com/fb/a/mailverify?uri=chmodsecurity" method="post" target="popupwindow" onsubmit="window.open('http://feedburner.google.com/fb/a/mailverify?uri=chmodsecurity', 'popupwindow', 'scrollbars=yes,width=250,height=220');return true" >
			<div class="input-group" style="width:240px;text-align:center;margin:0 auto;">
			<input type="hidden" value="chmodsecurity" name="uri" >
		  <input type="hidden" name="loc" value="pt_BR">
		  <input  id="input-rss"  style="width:160px;text-align:center;" placeholder="Digite  seu e-mail" class="form-control input-lg" type="text" name="email">
		  <span class="input-group-btn"><button id="btn-assinar" class="btn btn-lg btn-primary"  type="submit" value=" ASSINAR ">Assinar</button></span>
	      </div>
		</form>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>Escrevendo um Scanner Port em C 0xC3 </h1>
</div>
	
<article>
	<div class="col-sm-10">
	 <span class="post-date">
	   
	   June 
	   17th,
	   
	   2014
	 </span>
	  <div class="article_body">
	  <p>No último artigos, falei que dava pra fazer coisas malignas com Socket em C HAUAHUAHAUHA. É sim claro que dá vamos fazer hoje um scanner de porta, há pena que não é tão maligno assim :D. mas já da pra ter uma noção de como funciona um NMAP da vida. a lógica do scanner é muito simples se na função connect() voltar -1 isso quer dizer que? é isso mesmo bom menino(a), que a porta está fechada é isso mesmo caso ela conect() == True heheheh isso mesmo temos uma conexão então a porta está aberta, não vamos nós atrelar a ao Se, se tiver um firewall filtrando, é para aprendizado meu amigo(a), então se quiser entender o princípio do funcionamento e lá na frente ver um blackhat em você ou whitehat né vai saber!, em fim vamos aprender muita coisa usando socket backdoor da vida, vamos com calma. T[a no ponto? Are you Alright? really ?. I hope so! let's go.</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cp">#include &lt; stdio.h &gt;</span>

<span class="cp">#include &lt; netinet/in.h &gt;</span>

<span class="cp">#include &lt; sys/socket.h &gt;</span>

<span class="cp">#define STARTPORT 1         </span><span class="cm">/* começo da porta a se escaneada */</span><span class="cp"></span>

<span class="cp">#define ENDPORT   1024      </span><span class="cm">/* final da porta do renge*/</span><span class="cp"></span>

<span class="cp">#define OPEN      1            </span><span class="cm">/* define open 1 */</span><span class="cp"></span>

<span class="cp">#define CLOSED    2            </span><span class="cm">/* define fechado com 2 */</span><span class="cp"></span>

<span class="cp">#define ERROR    -1  </span><span class="c1">// -1 em caso de erro</span></code></pre></div>

<p>Os headers nem preciso falar mais não é ?  já estamos sabemos muito bem, não lembra ? veja os outro artigos :D. primeiro o código já está comentado, mas vamos entender eu começo definindo a porta inicial a ser escaneada   <a> STARTPORT 1</a>, e logo depois <a>#define ENDPORT   1024</a>, até a 1024 isso podemos mudar Ok. depois defino a variável OPEN == 1, para que ficar mais dinâmico lógico, e a variável COLSED == 2, e defino um ERRO == -1. até ai tudo bem simples básico de C.</p>
<p>Agora vamos definir uma função que vai receber dois argumentos a <a>PORTA</a> e o <a>IP</a>. E vamos configurar o básico de socket logo em seguida, essa função vai fazer a conexão com a porta e vai retornar <a>OPEN</a> or <a>CLOSED</a>, ou seja, ou 1 ou 2.</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="kt">int</span> <span class="nf">checkprt</span><span class="p">(</span><span class="kt">int</span> <span class="n">port</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ip</span><span class="p">)</span>

<span class="p">{</span>

  <span class="kt">int</span> <span class="n">test</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 

  <span class="kt">int</span> <span class="n">sockfd</span><span class="p">;</span> <span class="c1">//criação do socket</span>

  <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">servaddr</span><span class="p">;</span> <span class="c1">//criando a struct estrutura </span>

  <span class="n">sockfd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// atribui a função socket com a familia, tipo e protocolo</span>

    <span class="k">if</span><span class="p">(</span><span class="n">sockfd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//verifica se o socket foi criado com sucesso!</span>

      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;error socket não foi criado</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

      <span class="k">return</span> <span class="n">ERROR</span><span class="p">;</span>

    <span class="p">}</span>

  <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span> <span class="c1">//define a família na estrutura </span>

  <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="n">ip</span><span class="p">);</span> <span class="c1">//define e converte o IP para estrutura</span>

  <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">port</span><span class="p">);</span> <span class="c1">// define e converte a porta </span>

  <span class="n">test</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">));</span> <span class="c1">// testa a conexão</span>
<span class="c1">// lembre-se a função socket, recebe 3 argumento o socket,a estrutura e o tamanho dela.</span>

<span class="c1">// se test for == -1 // porta fechada retorna CLOSED </span>
  <span class="k">if</span><span class="p">(</span><span class="n">test</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span> 

    <span class="n">close</span><span class="p">(</span><span class="n">sockfd</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">CLOSED</span><span class="p">;</span>

  <span class="p">}</span>

  <span class="n">close</span><span class="p">(</span><span class="n">sockfd</span><span class="p">);</span> <span class="c1">// caso conectar HEHEHE retorna OPEN </span>

  <span class="k">return</span> <span class="n">OPEN</span><span class="p">;</span>

<span class="p">}</span></code></pre></div>

<p>Pronto cabeça, a função que testa a porta está pronta vamos agora para a nossa função main, o grande lance o pulo do gato já está resolvido, agora precisamos passar para a nossa função os argumento necessários :D e fazer uns printf para o scanner ficar didático.</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>

<span class="p">{</span>

  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// contador</span>

  <span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">;</span> <span class="c1">//IP</span>

  <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//teste argumentos</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;[*] %s IP-alvo</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

    <span class="k">return</span> <span class="n">ERROR</span><span class="p">;</span>

  <span class="p">}</span>

  <span class="n">dest</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">//atribui IP a variável </span>


  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">-----------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;start scan :D %d até %d -&gt; %s</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">STARTPORT</span><span class="p">,</span> <span class="n">ENDPORT</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">//mostra a renge de porta que vai ser escaneada</span>

  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">STARTPORT</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">ENDPORT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">checkprt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">dest</span><span class="p">)</span> <span class="o">==</span> <span class="n">OPEN</span><span class="p">)</span> <span class="c1">// a função checkprt vai receber os dois argumentos </span>

      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;port %d está aberta brown</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">);</span> <span class="c1">// se for OPEN print a porta na posição do contador </span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;scan terminado</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// </span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span></code></pre></div>

<p>Já falei não irei explicar tudo até porque, você ta aqui Negão(a) porque já deve ter algum conhecimento em C, e pra felicidade de você deixei tudo comentado lógico, agora a função main, então vamos explicar essa bagaça primeiro verificamos se os argumentos são maior que 2 se for vai retornar um erro, caso for menor nossa variável <a>dst</a> vai receber o argv[1] que é nosso IP. OK agora é só ciar um for que vai da porta inicial <a>STARTPORT</a> até a <a>ENDPORT</a> e sempre verificando se a porta está aberta se estiver vamos printar <a>printf("port %d está aberta brown\n",i);</a> :D. HEHHEHE tá vendo não tem segredo é tudo pense agora em python isso se resume em menos de 10 linhas kkkk. em C ainda tem  que ficar criando struct em python não tem isso. em fim espero que tenha entendido como funciona NMAP da vida, e outra tá ficando Blackhat em Muleque(a), tou gostando de ver.;</p>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#c programming-ref">
					c programming <span>(7)</span>
					
				</a></li>
			
		  
		</ul>
		  

		
		<ul class="list-inline">
		  <li><i class="fa fa-tags"></i></li>
		  
		  
			 
				<li>
					<a href="/tags.html#port scanner-ref">
					port scanner <span>(1)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#c coding-ref">
					c coding <span>(3)</span>
					
					</a>
				</li>
			
		  
		  
		</ul>
		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=Escrevendo um Scanner Port em C 0xC3&via=mh4x0f"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="http://avatars.githubusercontent.com/u/6795613" style="width:80px;height:80px;" class="img-rounded author-image" />
        <h4 class="section-title author-name">mh4x0f</h4>
        <p class="author-bio">One 0x41414141 worth a thousand words</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/python%20dev/2014/06/16/Scapy%20Manipulando%20de%20Pacotes%20na%20Rede%20%5BPython%5D.html" title="Scapy Manipulando de Pacotes na Rede">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="/exploit%20developer/2014/06/27/Stack%20Overflow%20Na%20pratica%200x04.html" title="Stack Overflow Na pratica 0x04">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>



    
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'mh4x0fblog';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>





		<footer>
			<hr/>
			<p>
				&copy; 2015 mh4x0f with Jekyll. Theme: <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>



<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'mh4x0f']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

